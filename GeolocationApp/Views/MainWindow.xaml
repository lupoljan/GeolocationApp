<Window x:Class="GeolocationApp.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:viewModels="clr-namespace:GeolocationApp.ViewModels"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        mc:Ignorable="d"
        Title="GeoLocator" 
        Height="600" 
        Width="800"
        FontFamily="Segoe UI"
        WindowStartupLocation="CenterScreen"
        Style="{StaticResource MaterialDesignWindow}">

    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Search Section -->
        <materialDesign:Card Grid.Row="0" Padding="16">
            <StackPanel Orientation="Horizontal">
                <TextBox Width="300" 
                       materialDesign:HintAssist.Hint="Enter IP address or URL"
                       Style="{StaticResource MaterialDesignFloatingHintTextBox}"
                       Text="{Binding Input, UpdateSourceTrigger=PropertyChanged}"/>

                <Button Content="FETCH" 
                      Command="{Binding FetchGeolocationCommand}"
                      Style="{StaticResource MaterialDesignRaisedButton}"
                      Margin="16,0,0,0"
                      ToolTip="Get geolocation data"/>
            </StackPanel>
        </materialDesign:Card>

        <!-- Fetched Data Display -->
        <GroupBox Grid.Row="1" Header="Fetched Geolocation Data" Margin="0,16">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Left Column -->
                <StackPanel Grid.Column="0" Margin="8">
                    <TextBlock Text="{Binding SelectedLocation.IP}" 
                             Style="{StaticResource MaterialDesignHeadline6TextBlock}"/>
                    <TextBlock Text="{Binding SelectedLocation.Url}" 
                             Style="{StaticResource MaterialDesignSubtitle1TextBlock}"
                             Foreground="Gray"/>

                    <StackPanel Margin="0,16,0,0">
                        <TextBlock Text="{Binding SelectedLocation.Country}"
                                 Style="{StaticResource MaterialDesignBody1TextBlock}"/>
                        <TextBlock Text="{Binding SelectedLocation.Region}"
                                 Style="{StaticResource MaterialDesignBody2TextBlock}"/>
                        <TextBlock Text="{Binding SelectedLocation.City}"
                                 Style="{StaticResource MaterialDesignBody2TextBlock}"/>
                    </StackPanel>
                </StackPanel>

                <!-- Right Column -->
                <StackPanel Grid.Column="1" Margin="8">
                    <TextBlock Text="Coordinates" 
                             Style="{StaticResource MaterialDesignSubtitle1TextBlock}"/>
                    <TextBlock Margin="0,8,0,0"
                             Text="{Binding SelectedLocation.Latitude, StringFormat='Latitude: {0:N4}'}"/>
                    <TextBlock Text="{Binding SelectedLocation.Longitude, StringFormat='Longitude: {0:N4}'}"/>

                    <Button Content="SAVE" 
                          Command="{Binding SaveToDatabaseCommand}"
                          Style="{StaticResource MaterialDesignRaisedButton}"
                          Margin="0,16,0,0"
                          HorizontalAlignment="Left"/>
                </StackPanel>
            </Grid>
        </GroupBox>

        <!-- Stored Locations List -->
        <DataGrid Grid.Row="2" 
                ItemsSource="{Binding Locations}"
                SelectedItem="{Binding SelectedLocation}"
                AutoGenerateColumns="False"
                Margin="0,16"
                Style="{StaticResource MaterialDesignDataGrid}"
                HeadersVisibility="Column">

            <DataGrid.Columns>
                <DataGridTextColumn Header="IP" Binding="{Binding IPAddress}" Width="*"/>
                <DataGridTextColumn Header="Country" Binding="{Binding Country}" Width="*"/>
                <DataGridTextColumn Header="City" Binding="{Binding City}" Width="*"/>
                <DataGridTemplateColumn Width="Auto">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Button
                                  Command="{Binding DataContext.DeleteFromDatabaseCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                  ToolTip="Delete selected"
                                  Style="{StaticResource MaterialDesignFlatButton}">
                                <materialDesign:PackIcon Kind="Delete" Width="24" Height="24"/>
                            </Button>

                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
            </DataGrid.Columns>
        </DataGrid>

        <!-- Status Bar -->
        <StatusBar Grid.Row="3">
            <TextBlock Text="{Binding Locations.Count, StringFormat='Total records: {0}'}"
                     Margin="8,0"/>
            <Separator/>
            <TextBlock Text="{Binding ErrorMessage}"
                     Foreground="Red"
                     Margin="8,0"
                     TextWrapping="Wrap"/>
        </StatusBar>
    </Grid>
</Window>